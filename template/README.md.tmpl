# {{.ProjectName}}

A Go application built with Vandor.

## Architecture

This project uses **{{.ArchitectureType}}** architecture with an architecture-agnostic structure:

```
internal/
├── domain/              # Business logic (architecture-specific internals)
├── adapter/             # Infrastructure & transport adapters
├── pkg/                 # Shared utilities (logger, config)
└── vpkg/                # Installed VPKG packages
```

## Getting Started

### Prerequisites

- Go 1.24 or later
- Task (https://taskfile.dev) - `go install github.com/go-task/task/v3/cmd/task@latest`
- Vandor CLI - `curl -fsSL https://vandor.dev/install.sh | bash`
- Air (for hot reload in development) - `go install github.com/air-verse/air@latest`
- Docker & Docker Compose (optional, for containerized development)

### Installation

1. Copy the example config:
```bash
cp config/config.yaml.example config/config.yaml
```

2. Install dependencies:
```bash
go mod tidy
```

3. Run the application:
```bash
task run
```

## Adding Components

This project starts minimal with only logger and config. Add components as needed:

```bash
# Add HTTP server
vandor vpkg add transport/http

# Add PostgreSQL database
vandor vpkg add storage/postgres

# Add Redis cache
vandor vpkg add cache/redis

# Add Kafka messaging
vandor vpkg add messaging/kafka

# See all available packages
vandor vpkg list
```

## Creating Domains

Domains represent business capabilities, not database tables:

```bash
# Create a domain (business capability)
vandor add domain order

# This creates the architecture-appropriate structure
# For hexagonal: core/, port/, application/
```

## Available Commands

### Entry Point Tasks (cmd/app)

- `task dev:app` - Run with hot reload (Air) - **Recommended for development**
- `task build:app` - Build the binary to `bin/app`
- `task run:app` - Run the compiled binary

### General Tasks

- `task test` - Run tests
- `task test:coverage` - Run tests with coverage
- `task lint` - Run linter
- `task fmt` - Format code
- `task tidy` - Tidy dependencies
- `task clean` - Clean build artifacts

### VPKG Commands

- `task vpkg:add -- <package>` - Add a VPKG package
- `task vpkg:list` - List installed packages
- `task vpkg:remove -- <package>` - Remove a package

### Domain Commands

- `task domain:add -- <name>` - Add a new domain
- `task sync` - Regenerate all code

## Project Structure

```
.
├── cmd/
│   └── app/                  # Application entrypoint
├── config/
│   └── config.yaml.example   # Configuration template
├── internal/
│   ├── domain/               # Business logic domains (empty initially)
│   ├── adapter/              # Infrastructure adapters (empty initially)
│   ├── pkg/
│   │   ├── logger/           # Logging (included)
│   │   └── config/           # Configuration (included)
│   └── vpkg/                 # Installed VPKG packages (empty initially)
├── test/
│   ├── integration/          # Integration tests
│   ├── e2e/                  # End-to-end tests
│   └── fixture/              # Test fixtures
├── taskfile.yaml             # Task definitions
├── go.mod                    # Go dependencies
└── README.md                 # This file
```

## Configuration

Configuration can be set via:

1. **Config file**: `config/config.yaml`
2. **Environment variables**: Prefix with `APP_` (e.g., `APP_LOGGER_LEVEL=debug`)

See `config/config.yaml.example` for available options.

## Development

### Hot Reload Development

For the best development experience with automatic reload on code changes:

```bash
task dev:app
```

This uses [Air](https://github.com/air-verse/air) to watch for file changes and automatically rebuild and restart your application. Each entry point has its own Air config (`.air.[name].toml`).

### Multiple Entry Points

When you add new entry points with `vandor add cmd`, each gets its own task set:

```bash
# After: vandor add cmd worker
task dev:worker     # Hot reload for worker
task build:worker   # Build worker binary
task run:worker     # Run worker binary

# After: vandor add cmd api
task dev:api        # Hot reload for API
task build:api      # Build API binary
task run:api        # Run API binary
```

### Running Tests

```bash
task test
```

### Code Coverage

```bash
task test:coverage
# Opens coverage.html in browser
```

### Linting

```bash
task lint
```

### Formatting

```bash
task fmt
```

## Docker

### Docker Compose (Recommended for Local Development)

Run the entire stack with dependencies:

```bash
# Start all services
docker-compose up

# Start in background
docker-compose up -d

# Start specific service
docker-compose up app

# View logs
docker-compose logs -f app

# Stop all services
docker-compose down
```

The `docker-compose.yaml` includes:
- **app** - Your application
- **postgres** - PostgreSQL database (commented, uncomment after adding storage/postgres)
- **redis** - Redis cache (commented, uncomment after adding cache/redis)
- **minio** - MinIO object storage (commented, uncomment after adding storage/minio)
- **kafka** - Kafka messaging (commented, uncomment after adding messaging/kafka)

### Build Individual Docker Images

```bash
# Build app image
docker build -f cmd/app/Dockerfile -t {{.ProjectName}}-app:latest .

# Build for specific entry point (after vandor add cmd)
docker build -f cmd/api/Dockerfile -t {{.ProjectName}}-api:latest .
docker build -f cmd/worker/Dockerfile -t {{.ProjectName}}-worker:latest .
```

### Multi-platform Builds

```bash
docker buildx build --platform linux/amd64,linux/arm64 \
  -f cmd/app/Dockerfile -t {{.ProjectName}}-app:latest .
```

## Documentation

- [Vandor Documentation](https://docs.vandor.dev)
- [Architecture Guide](https://docs.vandor.dev/architecture)
- [VPKG Packages](https://docs.vandor.dev/vpkg)
- [Domain-Driven Design](https://docs.vandor.dev/ddd)

## License

{{.License}}
